/**
 * index.css - 全局样式与动画
 * 结构：@layer base（变量、媒体查询）→ @layer utilities（工具类）→ 关键帧与动画类
 */
@tailwind base;
@tailwind components;
@tailwind utilities;

/* ---------- base：主题变量、prefers-reduced-motion、移动端/低端收口 ---------- */
@layer base {
  /* 主题变量（供 Tailwind 与组件使用） */
  :root {
    --color-bg-primary: 255 255 255;
    --color-bg-secondary: 248 250 252;
    --color-text-primary: 51 65 85;
    --color-text-secondary: 100 116 139;
    --color-border: 226 232 240;
    --color-glass: 255 255 255;
  }

  /* 深色主题变量 */
  .dark {
    --color-bg-primary: 15 23 42;
    --color-bg-secondary: 30 41 59;
    --color-text-primary: 226 232 240;
    --color-text-secondary: 148 163 184;
    --color-border: 51 65 85;
    --color-glass: 30 41 59;
  }
  
  /* 性能优化：用户偏好减少动画时禁用所有动画 */
  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }
  
  /* 移动端全局性能优化 */
  @media (max-width: 768px) {
    * {
      /* 禁用平滑滚动，提升滚动性能 */
      scroll-behavior: auto !important;
    }
    
    /* 滚动容器硬件加速 */
    .no-scrollbar {
      -webkit-transform: translateZ(0);
      transform: translateZ(0);
      -webkit-backface-visibility: hidden;
      backface-visibility: hidden;
      /* 启用惯性滚动 */
      -webkit-overflow-scrolling: touch;
    }
    
    /* 移动端进一步减轻 backdrop-blur，减少合成层开销 */
    .backdrop-blur-md {
      -webkit-backdrop-filter: blur(2px) !important;
      backdrop-filter: blur(2px) !important;
    }
    
    .backdrop-blur-lg,
    .backdrop-blur-xl {
      -webkit-backdrop-filter: blur(3px) !important;
      backdrop-filter: blur(3px) !important;
    }
    
    /* 移动端禁用 blob 动画，静止光团以提升帧率，去掉 will-change 减少合成层 */
    .animate-blob {
      animation: none !important;
      transform: translate3d(0, 0, 0) !important;
      will-change: auto !important;
    }
    
    /* 移动端禁用背景脚印移动动画，兼顾性能 */
    .animate-moveBackground,
    [class*="animate-moveBackground"] {
      animation: none !important;
      transform: translate3d(0, 0, 0) !important;
    }
    
    /* 移动端保留渐变动效，仅放慢以兼顾性能与观感 */
    .animate-gradient {
      animation-duration: 20s !important;
    }
    
    /* 移动端保留星光闪烁，仅放慢并去掉 filter 以兼顾性能与观感 */
    .twinkle-star {
      animation-duration: 24s !important;
      filter: none !important;
    }
    
    /* 移动端只保留前 3 颗角落星光，减少同时动画数量 */
    .corner-stars > span:nth-child(n + 4) {
      display: none !important;
    }
  }
  
  /* 低端设备/电池节省模式优化 */
  @media (max-width: 480px) {
    /* 极低端设备完全禁用 blob 背景动画 */
    .animate-blob {
      animation: none !important;
      transform: translate3d(0, 0, 0) !important;
    }
    
    /* 简化浮动动画 */
    .animate-float {
      animation-duration: 10s !important;
    }
    
    /* 完全禁用星星闪烁 */
    .twinkle-star {
      animation: none !important;
      opacity: 0.3 !important;
    }
  }
}

/* 工具层：自定义工具类 */
@layer utilities {
  /* Header 滚动隐藏：由 JS 通过 ref 切换，不触发 React 重渲染 */
  .header-hidden {
    transform: translateY(-2.5rem);
    opacity: 0;
  }

  /* 记忆卡片列表项：视口外跳过 layout/paint；overflow:visible 保证顶部胶带不被裁掉 */
  .memory-card-wrapper {
    content-visibility: auto;
    contain-intrinsic-size: 0 400px;
    overflow: visible;
  }

  /* 动画延迟工具类 */
  .animation-delay-2000 {
    animation-delay: 2s;
  }
  .animation-delay-4000 {
    animation-delay: 4s;
  }

  /* 渐变背景动画 */
  .animate-gradient {
    background-size: 400% 400%;
    animation: gradient 8s ease infinite;
    will-change: background-position;
    contain: layout style;
  }

  /* 纹理文字效果 */
  .texture-text {
    filter: drop-shadow(0 2px 0px rgba(255,255,255,0.5)) drop-shadow(0 4px 8px rgba(var(--shadow-rgb), 0.2));
    transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
  }

  .texture-text:hover {
    filter: drop-shadow(0 2px 0px rgba(255,255,255,0.6)) drop-shadow(0 15px 25px rgba(var(--shadow-rgb), 0.4)) brightness(1.1);
    transform: scale(1.05) translateY(-5px) rotate(-2deg);
    background-size: cover, 120px 120px !important; /* 背景放大 */
  }
}

/* 动画关键帧定义 */

/* 浮动动画：元素上下浮动，营造轻盈感 */
@keyframes float {
  0% { transform: translate3d(0, 0px, 0); }
  50% { transform: translate3d(0, -20px, 0); }
  100% { transform: translate3d(0, 0px, 0); }
}

.animate-float {
  animation: float 6s ease-in-out infinite;
  will-change: transform;
  backface-visibility: hidden;
}

/* 斑点动画：不规则移动和缩放，营造有机流动感 */
@keyframes blob {
  0% { transform: translate3d(0px, 0px, 0) scale(1); }
  33% { transform: translate3d(30px, -50px, 0) scale(1.1); }
  66% { transform: translate3d(-20px, 20px, 0) scale(0.9); }
  100% { transform: translate3d(0px, 0px, 0) scale(1); }
}

.animate-blob {
  animation: blob 7s infinite;
  will-change: transform;
  contain: layout style;
  backface-visibility: hidden;
}

/* 淡入向上动画：元素从下方淡入，营造出现感 */
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* 星星弹出动画：星星出现效果，营造惊喜感 */
@keyframes star-pop {
  0% {
    transform: translate3d(-50%, -50%, 0) scale(0);
    opacity: 0;
  }
  50% {
    transform: translate3d(-50%, -80%, 0) scale(1.2);
    opacity: 1;
  }
  100% {
    transform: translate3d(-50%, -110%, 0) scale(0.8);
    opacity: 0;
  }
}

.star-pop {
  animation: star-pop 0.7s ease-out forwards;
  will-change: transform, opacity;
  backface-visibility: hidden;
}

/* 头像振动动画：长按刷新时的振动效果 */
@keyframes avatarShake {
  0%, 100% { transform: translateX(0) rotate(0deg); }
  10% { transform: translateX(-2px) rotate(-2deg); }
  20% { transform: translateX(2px) rotate(2deg); }
  30% { transform: translateX(-3px) rotate(-1deg); }
  40% { transform: translateX(3px) rotate(1deg); }
  50% { transform: translateX(-2px) rotate(-2deg); }
  60% { transform: translateX(2px) rotate(2deg); }
  70% { transform: translateX(-3px) rotate(-1deg); }
  80% { transform: translateX(3px) rotate(1deg); }
  90% { transform: translateX(-1px) rotate(-1deg); }
}

/* 淡入向上动画应用类：用于元素进入时的平滑过渡 */
.animate-fadeInUp {
  animation: fadeInUp 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
}

/* 闪烁动画：光泽效果，营造金属质感 */
@keyframes shimmer {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

.animate-shimmer {
  background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.4) 50%, rgba(255,255,255,0) 100%);
  background-size: 200% 100%;
  animation: shimmer 3s infinite;
}

/* 背景移动动画：动物脚印/图标往返移动，路径长、速度快 */
@keyframes moveBackground {
  0%, 100% { transform: translate3d(0, 0, 0); }
  50% { transform: translate3d(200px, 200px, 0); }
}

/* 选择器需匹配 Tailwind 响应式类名 md:animate-moveBackground（实际为 .md\:animate-moveBackground） */
.animate-moveBackground,
[class*="animate-moveBackground"] {
  animation: moveBackground 25s ease-in-out infinite;
  will-change: transform;
  backface-visibility: hidden;
}

/* 脚印层：统一不透明度，不再用透明度蒙版 */
.footprint-vignette {
  opacity: 0.5;
}





/* 渐变动画：背景位置循环变化，用于彩虹渐变效果 */
@keyframes gradient {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

/* 覆盖层绽放动画：背景缓入，先淡入再保持可见 */
@keyframes overlay-bloom {
  0% {
    opacity: 0;
    filter: blur(20px);
  }
  55% {
    opacity: 1;
    filter: blur(4px);
  }
  100% {
    opacity: 1;
    filter: blur(4px);
  }
}

.overlay-bloom {
  animation: overlay-bloom 0.9s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
}

/* 覆盖层表情动画：表情符号弹出效果，结束后保持可见 */
@keyframes overlay-emoji {
  0% {
    opacity: 0;
    transform: translateY(40px) scale(0.8);
  }
  40% {
    opacity: 1;
    transform: translateY(0) scale(1.05);
  }
  100% {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

.overlay-emoji {
  animation: overlay-emoji 0.9s cubic-bezier(0.18, 0.89, 0.32, 1.28) forwards;
}

/* 覆盖层环形动画：环形扩散效果，结束后保持可见 */
@keyframes overlay-ring {
  0% {
    transform: scale(0.7);
    opacity: 0;
  }
  35% {
    opacity: 0.9;
  }
  100% {
    transform: scale(1.2);
    opacity: 0.8;
  }
}

.overlay-ring {
  animation: overlay-ring 0.9s ease-out forwards;
}

/* 圆环进度到 100% 时短暂高光，增强「填满」反馈 */
.overlay-ring-complete {
  animation: overlay-ring-complete 0.6s ease-out forwards;
}

@keyframes overlay-ring-complete {
  0% {
    filter: drop-shadow(0 0 6px rgba(168, 85, 247, 0.4));
  }
  40% {
    filter: drop-shadow(0 0 12px rgba(168, 85, 247, 0.6));
  }
  100% {
    filter: drop-shadow(0 0 8px rgba(168, 85, 247, 0.2));
  }
}

/* 覆盖层停留时呼吸动画：轻微缩放，进入动画结束后开始 */
@keyframes overlay-breathe {
  0%, 100% {
    transform: translateY(0) scale(1);
  }
  50% {
    transform: translateY(0) scale(1.04);
  }
}

.overlay-breathe {
  animation: overlay-breathe 2.2s ease-in-out infinite;
  animation-delay: 0.95s;
}

/* 覆盖层背景缓出：收回时渐变淡出，避免突然变色 */
@keyframes overlay-bg-fade-out {
  0% { opacity: 1; }
  100% { opacity: 0; }
}

.overlay-bg-fade-out {
  animation: overlay-bg-fade-out 0.45s ease-out forwards;
}

/* 覆盖层收回动画：轻微缩小淡出，干净不花哨 */
@keyframes overlay-retract {
  0% {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
  100% {
    opacity: 0;
    transform: translateY(0) scale(0.94);
  }
}

.overlay-retract {
  animation: overlay-retract 0.45s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

/* 覆盖层「正在加载」文案收回时淡出，不突然消失 */
@keyframes overlay-loading-text-fade-out {
  0% { opacity: 1; }
  100% { opacity: 0; }
}

.overlay-loading-text-fade-out {
  animation: overlay-loading-text-fade-out 0.35s ease-out forwards;
}

/* 互锁动画：左右交替移动，营造齿轮转动效果 */
@keyframes interlock-left {
  0%, 100% { transform: translateX(0); }
  50% { transform: translateX(50%); }
}

@keyframes interlock-right {
  0%, 100% { transform: translateX(0); }
  50% { transform: translateX(-50%); }
}

.animate-interlock-left {
  animation: interlock-left 4s ease-in-out infinite;
}

.animate-interlock-right {
  animation: interlock-right 4s ease-in-out infinite;
}

/* 闪烁星星动画：柔和闪烁效果，营造星空感觉 */
.twinkle-star {
  animation: soft-twinkle 16s ease-in-out infinite;
  filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.35));
  will-change: opacity, transform;
  backface-visibility: hidden;
  contain: layout style;
}

@keyframes soft-twinkle {
  0%, 72%, 100% {
    opacity: 0;
    transform: scale(0.8);
  }
  10% {
    opacity: 0.55;
    transform: scale(1);
  }
  16% {
    opacity: 0.25;
    transform: scale(0.92);
  }
}

/* 硬币掉落动画：硬币从上方掉落，用于奖励效果 */
@keyframes coin-drop {
  0% { transform: translateY(-50px) scale(0.5); opacity: 0; }
  20% { opacity: 1; }
  90% { transform: translateY(0) scale(0.8); opacity: 1; }
  100% { transform: translateY(10px) scale(0.5); opacity: 0; }
}

/* 小猪存钱罐弹跳动画：弹性缩放和旋转，用于收集硬币时的反馈 */
@keyframes piggy-bounce {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.2) rotate(5deg); }
}

.animate-coin-drop {
  animation: coin-drop 1s ease-in forwards;
}

.animate-piggy-bounce {
  animation: piggy-bounce 0.3s ease-out;
}

/* 向上浮动动画：元素向上飘浮消失，用于爱心等飘散效果 */
@keyframes float-up {
  0% { transform: translateY(0) scale(0.8); opacity: 0; }
  20% { opacity: 1; transform: translateY(-10px) scale(1.1); }
  100% { transform: translateY(-50px) scale(1); opacity: 0; }
}

/* 摇晃动画：左右摇摆，用于错误或拒绝反馈 */
@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-5px) rotate(-5deg); }
  75% { transform: translateX(5px) rotate(5deg); }
}

.animate-float-up {
  animation: float-up 1.5s ease-out forwards;
}

.animate-shake {
  animation: shake 0.5s ease-in-out;
}

/* 印章进入动画：弹性缩放进入效果，用于保存记忆成功提示 */
@keyframes stamp-in {
  0% { transform: scale(3); opacity: 0; }
  60% { transform: scale(0.8); opacity: 1; }
  80% { transform: scale(1.1); }
  100% { transform: scale(1); opacity: 1; }
}

.animate-stamp-in {
  animation: stamp-in 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
}

@keyframes popIn {
  0% {
    opacity: 0;
    transform: scale(0.9) translateY(10px);
  }
  100% {
    opacity: 1;
    transform: scale(1) translateY(0);
  }
}

.animate-popIn {
  animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
}

/* Logo 可爱小动画：轻柔呼吸缩放 + 一点点光晕 */
@keyframes logo-breathe {
  0%, 100% {
    transform: scale(1);
    filter: drop-shadow(0 0 20px rgba(251, 113, 133, 0.15));
  }
  50% {
    transform: scale(1.03);
    filter: drop-shadow(0 0 28px rgba(251, 113, 133, 0.25)) drop-shadow(0 0 40px rgba(168, 85, 247, 0.12));
  }
}

.logo-cute {
  animation: logo-breathe 3s ease-in-out infinite;
  transform-origin: center center;
}

/* 天数数字可爱小动画：轻柔心跳感 */
@keyframes days-number-pulse {
  0%, 100% {
    transform: scale(1);
    text-shadow: 0 4px 12px rgba(244, 63, 94, 0.2);
  }
  50% {
    transform: scale(1.06);
    text-shadow: 0 6px 20px rgba(244, 63, 94, 0.35), 0 0 24px rgba(244, 63, 94, 0.15);
  }
}

.days-number-cute {
  animation: days-number-pulse 2.2s ease-in-out infinite;
  transform-origin: center center;
}

/* 登录页卡片：高级感样式（分层阴影 + 顶部高光 + 微妙渐变）+ 悬停与身份卡一致的上浮与阴影 */
.login-card {
  box-shadow:
    0 20px 60px -15px rgba(0, 0, 0, 0.06),
    0 40px 90px -25px rgba(251, 113, 133, 0.06),
    inset 0 1px 0 rgba(255, 255, 255, 0.65);
  transition: box-shadow 0.5s ease;
}

.login-card:hover {
  box-shadow:
    0 28px 60px -15px rgba(0, 0, 0, 0.08),
    0 48px 90px -25px rgba(251, 113, 133, 0.12),
    inset 0 1px 0 rgba(255, 255, 255, 0.7);
}

.login-card::before {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: inherit;
  pointer-events: none;
  z-index: 0;
  background: linear-gradient(180deg, rgba(255, 255, 255, 0.15) 0%, transparent 38%);
}

.dark .login-card {
  box-shadow:
    0 20px 60px -15px rgba(0, 0, 0, 0.3),
    0 40px 90px -25px rgba(0, 0, 0, 0.15),
    inset 0 1px 0 rgba(255, 255, 255, 0.06);
}

.dark .login-card:hover {
  box-shadow:
    0 28px 60px -15px rgba(0, 0, 0, 0.35),
    0 48px 90px -25px rgba(0, 0, 0, 0.2),
    inset 0 1px 0 rgba(255, 255, 255, 0.08);
}

.dark .login-card::before {
  background: linear-gradient(180deg, rgba(255, 255, 255, 0.05) 0%, transparent 45%);
}

/* 登录页卡片：像浮在水面上缓慢移动与轻微旋转 */
@keyframes login-card-float {
  0%, 100% { transform: translateY(0) translateX(0) rotate(0deg); }
  20% { transform: translateY(-18px) translateX(10px) rotate(1deg); }
  40% { transform: translateY(-6px) translateX(-10px) rotate(-0.9deg); }
  60% { transform: translateY(14px) translateX(-12px) rotate(0.7deg); }
  80% { transform: translateY(10px) translateX(10px) rotate(-0.5deg); }
}

.login-card-float {
  animation: login-card-float 12s ease-in-out infinite;
  will-change: transform;
}

/* 登录页卡片内部：光带缓慢扫过 + 噪点轻微呼吸 */
@keyframes login-card-shimmer {
  0% { background-position: 200% 50%; }
  100% { background-position: -100% 50%; }
}

@keyframes login-card-noise-breath {
  0%, 100% { opacity: 0.06; }
  50% { opacity: 0.14; }
}

.login-card-texture {
  position: absolute;
  inset: 0;
  border-radius: inherit;
  pointer-events: none;
  z-index: 1;
  overflow: hidden;
}

.login-card-shimmer {
  position: absolute;
  inset: 0;
  border-radius: inherit;
  background: linear-gradient(
    105deg,
    transparent 0%,
    rgba(255, 255, 255, 0.15) 18%,
    rgba(251, 113, 133, 0.08) 38%,
    transparent 50%,
    rgba(147, 197, 253, 0.08) 68%,
    rgba(255, 255, 255, 0.12) 85%,
    transparent 100%
  );
  background-size: 200% 100%;
  animation: login-card-shimmer 14s ease-in-out infinite;
}

.dark .login-card-shimmer {
  background: linear-gradient(
    105deg,
    transparent 0%,
    rgba(255, 255, 255, 0.06) 18%,
    rgba(251, 113, 133, 0.04) 38%,
    transparent 50%,
    rgba(147, 197, 253, 0.04) 68%,
    rgba(255, 255, 255, 0.08) 85%,
    transparent 100%
  );
}

.login-card-noise {
  position: absolute;
  inset: 0;
  border-radius: inherit;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
  background-size: 100px 100px;
  animation: login-card-noise-breath 5s ease-in-out infinite;
}

.dark .login-card-noise {
  opacity: 0.08;
}
